Begriffe
--------
Netz - Verbund von Controllern (Netzteilnehmer), welche miteinander kommunizieren koennen.
Segment - Ein Teil eines Netzes mit gleicher Bustopologie z.B. ein RS485 Bus
Router - Verbindet mehrere Segmente der gleicher oder unterschiedlicher Topologie.

Anforderungen
-------------
Alle Netzteilnehmer koennen miteinander kommunizieren.
Netzsegmente koennen Ueber Routercontroller miteinander verbunden werden.
Alle Netzteilnehmer haben eine eindeutige Adresse.


Netzaufbau
----------

Kommunikationsablauf:

1) Zu Beginn sendet der Master das Token fuer den ersten Sender.
2) Der angesprochene Sender sendet daraufhin seine Nachricht. Wenn er nichts zu senden hat sendet er eine leere Nachricht.
3) Der Master sendet das Token fuer den naechsten Sender.
4) Der naechste Sender sendet seine Nachricht.
5) Und so weiter.
6) Wenn alle Teilnehmer angeprochen wurden, gibt es eine Pause von 3Bytes ms.


Fehlersituationen:

 * Ein Sender sendet nicht, nachdem das Token verschickt wurde:
   Jeder Sender muss innerhalb von 2Bytes Sendezeit auf das Token antworten, an sonsten wird nach einer Pause von einem weiteren Byte mit dem nÃ¤chsten Token weitergemacht. Damit sieht es auf dem Bus so aus, wie eine neue Runde Kommunikation.
 * Der Master faellt aus:
   Der Master kann mit einer Nachricht Stellvertreter ernennen. Wird innerhalb von 10Bytes Sendezeit kein Token empfangen, Ã¼bernimmt der Vertreter das Takten des Busses.


Nachrichtenformate auf dem Bus
-------------------------------

Token:

+--+--+
|SY|TS|
+--+--+
SY - Syncronization byte: 'Ü' = 0b10011010
TS - Token for next sender. MSB=1 lower 7bit = address of next sender.


Nachricht:

+--+--+--+--+--+---------+----+----+
|SY|AS|LE|AR|EA|MD ... MD|CRCH|CRCL|
+--+--+--+--+--+---------+----+----+
SY - Syncronization byte: 'Ü' = 0b10011010
AS - Address sender on bus 7bit
LE - Length of message from AR to CRCL
AR - Address receiver 7bit
EA - Extended address 4bit sender in higher nibble, 4bit receiver in lower nibble.
MD - Message data
CRCH - High byte of 16bit CRC
CRCL - Low byte of 16bit CRC


Leere Nachricht:

+--+--+--+
|SY|AS| 0|
+--+--+--+
SY - Syncronization byte: 'Ü' = 0b10011010
AS - Address sender on bus 7bit
LE - Length of message == 0


Adressierung der Busteilnehmer:

Damit dürfen keine zwei Teilnehmer mit identischen unteren 7bits der Adresse in einem Segment liegen.
Die Adresse für Nachrichten an alle "Broadcasts" ist 0b11111111111 = 0x3FF.
Die Adresse für Nachriten an alle Teilnehmer eines Segments ist 0b1111111 = 0x7F.
Der Busteilnehmer, welcher das Takten des Busses übernimmt, also der Master, hat die Adresse 0.



